<!-- TODO(psimakov): use local YUI library -->
<link rel="stylesheet" type="text/css"
    href="/static/yui_3.6.0/yui/build/cssreset-context/cssreset-context-min.css">
<script
    src="/static/yui_3.6.0/yui/build/yui/yui.js"></script>
<link rel="stylesheet" type="text/css"
    href="/static/inputex-3.1.0/src/inputex/assets/skins/sam/inputex.css">
<link rel="stylesheet" type="text/css" href="/modules/oeditor/resources/butterbar.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/modules/oeditor/resources/butterbar.js" type='text/javascript'></script>
<script
    src="/static/inputex-3.1.0/src/loader.js" type='text/javascript'></script>
<script
    src="/static/inputex-3.1.0/lib/jsonPretty.js" type='text/javascript'></script>

{% if can_highlight_code %}
  <!-- import CodeMirror -->
  <script src="/static/codemirror/lib/codemirror.js"></script>
  <link rel="stylesheet" href="/static/codemirror/lib/codemirror.css">
  <script src="/static/codemirror/mode/htmlmixed/htmlmixed.js"></script>
  <script src="/static/codemirror/mode/xml/xml.js"></script>
  <script src="/static/codemirror/mode/javascript/javascript.js"></script>
  <script src="/static/codemirror/mode/css/css.js"></script>
  <script src="/static/codemirror/keymap/sublime.js"></script>
{% endif %}

<!-- import extension libraries. -->
{% for url in extra_script_tag_urls %}
  <script src='{{ url }}'></script>
{% endfor %}

<link rel="stylesheet" type="text/css"
    href="/modules/oeditor/resources/oeditor.css"/>
<style>
  {% for file in extra_css_files %}
    {% include file %}
  {% endfor %}
</style>

<div id='oeditor-container'>
  <div class='gcb-butterbar-container'>
    <div class='gcb-butterbar' id='gcb-butterbar-top' style='top:-45px'>
      <p id='gcb-butterbar-message'></p>
      <a id='gcb-butterbar-close'>X</a>
    </div>
  </div>
  <div style='width: 100%;' align='center' class='yui3-skin-sam yui-skin-sam'>
    <div class='form' id='formContainer'></div>
  </div>
</div>
<div id='modal-editor' class='hidden'>
  <div class='background'></div>
</div>

<script type='text/javascript'>
  (function() {
    //keep all our global objects here
    var cb_global = {};

    // various URL's needed by the form
    cb_global.get_url = '{{ get_url }}';
    cb_global.save_url = '{{ save_url }}';
    cb_global.save_args = JSON.parse("{{ save_args|js_string }}");
    cb_global.exit_button_caption = '{{ exit_button_caption }}';
    cb_global.exit_url = '{{ exit_url }}';
    cb_global.save_method = '{{ save_method }}';
    cb_global.auto_return = {% if auto_return %}true{% else %}false{% endif %};
    cb_global.bundle_lib_files = {% if bundle_lib_files %}true{% else %}false{% endif %};

    // If this value is '', deletions are not allowed
    cb_global.delete_url = '{{ delete_url }}';
    cb_global.delete_method = '{{ delete_method }}';

    // button captions
    cb_global.delete_button_caption = '{{ delete_button_caption }}'
    cb_global.save_button_caption = '{{ save_button_caption }}'
    cb_global.custom_rte_tag_icons = JSON.parse("{{ custom_rte_tag_icons|js_string }}");

    cb_global.required_modules = [{% for module in required_modules %}
        '{{ module }}'{% if not loop.last %},{% endif %}{% endfor %}];
    cb_global.schema = JSON.parse("{{ schema|js_string }}");
    cb_global.delete_message = '{{ delete_message }}';
    cb_global.can_highlight_code = {% if can_highlight_code %}true{% else %}false{% endif %};
    cb_global.load_schema_with_annotations = function(schema) {
      {% for annotation in schema_annotations %}
        schema.root{% for element in annotation[0] %}['{{element}}']{% endfor %}
          = JSON.parse("{{ annotation[1]|js_string }}")
      {% endfor %}
    }
    cb_global.onFormLoad = function(Y) {
      {% for file in extra_js_files %}
        {% include file %}
      {% endfor %}
    };

    {% include 'oeditor.js' %}
    {% include 'rte.js' %}
    {% include 'popup.js' %}

    onPageLoad(cb_global);
  })();
</script>
